<div class="container-fluid mt-4">
  <!-- Header avec statut de connexion -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="mb-0">
          <i class="bi bi-activity me-2"></i>
          Monitoring des Tickets en Temps R√©el
        </h2>
        <div class="d-flex gap-2">
          <button 
            class="btn btn-outline-primary btn-sm" 
            (click)="reconnect()"
            [disabled]="isConnected">
            <i class="bi bi-arrow-clockwise me-1"></i>
            Reconnecter
          </button>
          <button 
            class="btn btn-outline-danger btn-sm" 
            (click)="clearMessages()"
            [disabled]="messages.length === 0">
            <i class="bi bi-trash me-1"></i>
            Effacer
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Statut de connexion -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="alert alert-dismissible border-0 shadow-sm" 
           [class.alert-success]="isConnected" 
           [class.alert-danger]="!isConnected && connectionError"
           [class.alert-warning]="!isConnected && !connectionError">
        <i class="bi me-2" 
           [class.bi-wifi]="isConnected"
           [class.bi-wifi-off]="!isConnected"></i>
        <strong>Connexion WebSocket:</strong>
        <span *ngIf="isConnected" class="ms-2">
          ‚úÖ Connect√© - En √©coute des √©v√©nements
        </span>
        <span *ngIf="!isConnected && connectionError" class="ms-2">
          ‚ùå Erreur: {{ connectionError }}
        </span>
        <span *ngIf="!isConnected && !connectionError" class="ms-2">
          üîÑ Connexion en cours...
        </span>
      </div>
    </div>
  </div>

  <!-- Statistiques -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <i class="bi bi-bar-chart-line fs-2 text-primary mb-2"></i>
          <h5 class="card-title">Total Messages</h5>
          <h3 class="text-primary">{{ stats.totalMessages }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <i class="bi bi-plus-circle fs-2 text-success mb-2"></i>
          <h5 class="card-title">Cr√©ations</h5>
          <h3 class="text-success">{{ stats.creates }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <i class="bi bi-pencil-square fs-2 text-warning mb-2"></i>
          <h5 class="card-title">Mises √† jour</h5>
          <h3 class="text-warning">{{ stats.updates }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <i class="bi bi-trash fs-2 text-danger mb-2"></i>
          <h5 class="card-title">Suppressions</h5>
          <h3 class="text-danger">{{ stats.deletes }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Messages vides -->
  <div *ngIf="messages.length === 0" class="row">
    <div class="col-12">
      <div class="text-center py-5">
        <i class="bi bi-inbox display-1 text-muted"></i>
        <h4 class="text-muted mt-3">Aucun √©v√©nement re√ßu</h4>
        <p class="text-muted">Les √©v√©nements de tickets appara√Ætront ici en temps r√©el</p>
      </div>
    </div>
  </div>

  <!-- Liste des messages -->
  <div class="row" *ngIf="messages.length > 0">
    <div class="col-12">
      <h4 class="mb-3">
        <i class="bi bi-clock-history me-2"></i>
        Derniers √âv√©nements ({{ messages.length }})
      </h4>
      
      <div class="timeline">
        <div *ngFor="let msg of messages; let i = index" 
             class="timeline-item mb-4">
          <div class="card border-0 shadow-sm hover-shadow">
            <div class="card-header bg-light border-0">
              <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                  <span class="badge me-2" 
                        [class]="'bg-' + getOperationColor(msg.payload.op)">
                    <i [class]="getOperationIcon(msg.payload.op)" class="me-1"></i>
                    {{ getOperationLabel(msg.payload.op) }}
                  </span>
                  <small class="text-muted">
                    {{ formatTimestamp(msg.payload.ts_ms) }}
                  </small>
                </div>
                <small class="text-muted">
                  #{{ i + 1 }}
                </small>
              </div>
            </div>
            
            <div class="card-body">
              <!-- Informations du ticket -->
              <div *ngIf="msg.payload.after" class="ticket-info">
                <div class="row">
                  <div class="col-md-8">
                    <h6 class="card-title mb-2">
                      <i class="bi bi-ticket-perforated me-1"></i>
                      {{ msg.payload.after.title }}
                    </h6>
                    <p class="card-text text-muted small mb-3">
                      {{ msg.payload.after.description }}
                    </p>
                    
                    <div class="d-flex flex-wrap gap-2 mb-3">
                      <span class="badge bg-light text-dark">
                        <i class="bi bi-tag me-1"></i>
                        {{ msg.payload.after.category }}
                      </span>
                      <span class="badge bg-light text-dark">
                        <i class="bi bi-bug me-1"></i>
                        {{ msg.payload.after.type }}
                      </span>
                      <span class="badge" 
                            [class]="'bg-' + getPriorityColor(msg.payload.after.priority)">
                        <i class="bi bi-exclamation-triangle me-1"></i>
                        {{ msg.payload.after.priority }}
                      </span>
                      <span class="badge" 
                            [class]="'bg-' + getStatusColor(msg.payload.after.status)">
                        <i class="bi bi-flag me-1"></i>
                        {{ msg.payload.after.status }}
                      </span>
                    </div>
                  </div>
                  
                  <div class="col-md-4">
                    <div class="small text-muted">
                      <div class="mb-2">
                        <i class="bi bi-hash me-1"></i>
                        <strong>ID:</strong> {{ msg.payload.after.id }}
                      </div>
                      <div class="mb-2">
                        <i class="bi bi-calendar-plus me-1"></i>
                        <strong>Cr√©√©:</strong> {{ formatMicroTimestamp(msg.payload.after.created_date) }}
                      </div>
                      <div *ngIf="msg.payload.after.last_modified_date" class="mb-2">
                        <i class="bi bi-calendar-check me-1"></i>
                        <strong>Modifi√©:</strong> {{ formatMicroTimestamp(msg.payload.after.last_modified_date) }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Informations techniques -->
              <div class="mt-3 pt-3 border-top">
                <details>
                  <summary class="btn btn-link p-0 text-decoration-none small">
                    <i class="bi bi-gear me-1"></i>
                    D√©tails techniques
                  </summary>
                  <div class="mt-2 p-3 bg-light rounded">
                    <div class="row small">
                      <div class="col-md-6">
                        <strong>Source:</strong>
                        <ul class="list-unstyled ms-3">
                          <li>Base: {{ msg.payload.source.db }}</li>
                          <li>Table: {{ msg.payload.source.table }}</li>
                          <li>Connecteur: {{ msg.payload.source.connector }}</li>
                          <li>Version: {{ msg.payload.source.version }}</li>
                        </ul>
                      </div>
                      <div class="col-md-6">
                        <strong>Transaction:</strong>
                        <ul class="list-unstyled ms-3">
                          <li>ID: {{ msg.payload.source.txId }}</li>
                          <li>LSN: {{ msg.payload.source.lsn }}</li>
                          <li>Timestamp: {{ formatTimestamp(msg.payload.source.ts_ms) }}</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </details>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>