 <!-- Modal Backdrop -->
    <div class="modal fade" 
         id="ticketDetailsModal" 
         tabindex="-1" 
         aria-labelledby="ticketDetailsModalLabel" 
         aria-hidden="true"
         [class.show]="isVisible"
         [style.display]="isVisible ? 'block' : 'none'">
      
      <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content border-0 shadow-lg">
          
          <!-- Header -->
          <div class="modal-header bg-primary text-white border-0">
            <div class="d-flex align-items-center">
              <i class="bi bi-ticket-detailed me-2 fs-4"></i>
              <div>
                <h5 class="modal-title mb-0" id="ticketDetailsModalLabel">
                  {{ ticket?.title || 'Ticket Details' }}
                </h5>
                <small class="opacity-75">
                  <i class="bi bi-hash"></i>{{ ticket?.id || 'N/A' }}
                </small>
              </div>
            </div>
            <button type="button" 
                    class="btn-close btn-close-white" 
                    (click)="closeDialog()"
                    aria-label="Close">
            </button>
          </div>

          <!-- Body -->
          <div class="modal-body p-0">
            
            <!-- Status and Priority Bar -->
            <div class="bg-light p-3 border-bottom">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="d-flex align-items-center">
                    <small class="text-muted me-2">STATUS</small>
                    <span class="badge" [ngClass]="getStatusClass()">
                      <i [class]="getStatusIcon()"></i>
                      {{ ticket?.status || 'OPEN' }}
                    </span>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="d-flex align-items-center">
                    <small class="text-muted me-2">PRIORITY</small>
                    <span class="badge" [ngClass]="getPriorityClass()">
                      <i [class]="getPriorityIcon()"></i>
                      {{ ticket?.priority || 'LOW' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Description Section -->
            <div class="p-4" *ngIf="ticket?.description">
              <h6 class="text-muted mb-3">
                <i class="bi bi-file-text me-2"></i>Description
              </h6>
              <p class="mb-0 lh-base">{{ ticket?.description }}</p>
            </div>

            <!-- Details Grid -->
            <div class="p-4">
              <h6 class="text-muted mb-3">
                <i class="bi bi-info-circle me-2"></i>Ticket Information
              </h6>
              
              <div class="row g-3">
                <!-- Category -->
                <div class="col-md-6">
                  <div class="card border-0 bg-light h-100">
                    <div class="card-body p-3">
                      <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-folder text-primary me-2"></i>
                        <small class="text-muted">Category</small>
                      </div>
                      <div class="fw-semibold">{{ ticket?.category || 'N/A' }}</div>
                    </div>
                  </div>
                </div>

                <!-- Type -->
                <div class="col-md-6">
                  <div class="card border-0 bg-light h-100">
                    <div class="card-body p-3">
                      <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-tag text-info me-2"></i>
                        <small class="text-muted">Type</small>
                      </div>
                      <div class="fw-semibold">{{ ticket?.type || 'N/A' }}</div>
                    </div>
                  </div>
                </div>

                <!-- Created Date -->
                <div class="col-md-6">
                  <div class="card border-0 bg-light h-100">
                    <div class="card-body p-3">
                      <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-calendar-plus text-success me-2"></i>
                        <small class="text-muted">Created</small>
                      </div>
                      <div class="fw-semibold">
                        {{ ticket?.createdDate | date:'medium'  }}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Updated Date / Resolution Time -->
                <div class="col-md-6" *ngIf="ticket?.resolutionTime">
                  <div class="card border-0 bg-light h-100">
                    <div class="card-body p-3">
                      <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-calendar-check text-success me-2"></i>
                        <small class="text-muted">Resolution Time</small>
                      </div>
                      <div class="fw-semibold">
                        {{ ticket?.resolutionTime | date:'medium' }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Assignment Section -->
            <div class="p-4 border-top" *ngIf="ticket?.sender || ticket?.recipient">
              <h6 class="text-muted mb-3">
                <i class="bi bi-people me-2"></i>Assignment
              </h6>
              
              <div class="row g-3">
                <!-- Creator -->
                <div class="col-md-6" *ngIf="ticket?.sender">
                  <div class="d-flex align-items-center">
                    <div class="avatar-circle me-3">
                      <i class="bi bi-person-plus text-primary"></i>
                    </div>
                    <div>
                      <div class="fw-semibold">{{ ticket?.sender?.fullName }}</div>
                      <small class="text-muted">Creator</small>
                      <div class="small text-muted" *ngIf="ticket?.sender?.email">
                        <i class="bi bi-envelope me-1"></i>{{ ticket?.sender?.email }}
                      </div>
                      <div class="small text-muted" *ngIf="ticket?.sender?.fullName">
                        <i class="bi bi-building me-1"></i>{{ ticket?.sender?.fullName }}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Assignee -->
                <div class="col-md-6" *ngIf="ticket?.recipient">
                  <div class="d-flex align-items-center">
                    <div class="avatar-circle me-3">
                      <i class="bi bi-person-check text-success"></i>
                    </div>
                    <div>
                      <div class="fw-semibold">{{ ticket?.recipient?.fullName }}</div>
                      <small class="text-muted">Assigned to</small>
                      <div class="small text-muted" *ngIf="ticket?.recipient?.email">
                        <i class="bi bi-envelope me-1"></i>{{ ticket?.recipient?.email }}
                      </div>
                      <div class="small text-muted" *ngIf="ticket?.recipient?.fullName">
                        <i class="bi bi-building me-1"></i>{{ ticket?.recipient?.fullName }}
                      </div>
                      <div class="small text-muted" *ngIf="ticket?.recipient?.fullName">
                        <i class="bi bi-person-badge me-1"></i>{{ ticket?.recipient?.fullName }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Tags Section - Removed since not in TicketResponse -->
            
            <!-- Attachments Section -->
            <div class="p-4 border-top" *ngIf="ticket?.attachmentUrls?.length! > 0">
              <h6 class="text-muted mb-3">
                <i class="bi bi-paperclip me-2"></i>Attachments ({{ ticket?.attachmentUrls?.length }})
              </h6>
              <div class="row g-2">
                <div class="col-md-6" *ngFor="let attachmentUrl of ticket?.attachmentUrls; let i = index">
                  <div class="card border-0 bg-light">
                    <div class="card-body p-3">
                      <div class="d-flex align-items-center">
                        <i class="bi bi-file-earmark text-primary me-3 fs-4"></i>
                        <div class="flex-grow-1">
                          <div class="fw-semibold small">Attachment {{ i + 1 }}</div>
                          <div class="text-muted small text-truncate" style="max-width: 200px;">
                            {{ attachmentUrl }}
                          </div>
                        </div>
                        <div class="dropdown">
                          <button class="btn btn-sm btn-outline-primary dropdown-toggle" 
                                  type="button" 
                                  [id]="'attachment-' + i" 
                                  data-bs-toggle="dropdown">
                            <i class="bi bi-three-dots"></i>
                          </button>
                          <ul class="dropdown-menu">
                            <li>
                              <a class="dropdown-item" 
                                 [href]="attachmentUrl" 
                                 target="_blank">
                                <i class="bi bi-eye me-2"></i>View
                              </a>
                            </li>
                            <li>
                              <a class="dropdown-item" 
                                 [href]="attachmentUrl" 
                                 download>
                                <i class="bi bi-download me-2"></i>Download
                              </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                              <button class="dropdown-item" 
                                      (click)="copyToClipboard(attachmentUrl)">
                                <i class="bi bi-clipboard me-2"></i>Copy URL
                              </button>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>


<!-- Comments Section - À ajouter avant le Footer dans votre modal -->
<div class="p-4 border-top">
  <h6 class="text-muted mb-3">
    <i class="bi bi-chat-dots me-2"></i>Comments 
    <span class="badge bg-secondary ms-2" *ngIf="ticket?.comments?.length">
      {{ ticket?.comments?.length }}
    </span>
  </h6>
  
  <!-- Liste des commentaires existants -->
  <div class="comments-section mb-4" *ngIf="ticket?.comments?.length; else noComments">
    <div class="comment-card card bg-light" *ngFor="let comment of ticket?.comments;">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <div class="d-flex align-items-center">
            <div class="avatar-circle me-2" style="width: 32px; height: 32px;">
              <i class="bi bi-person-fill text-primary"></i>
            </div>
            <div>
              <span class="comment-author small">{{ comment.user.fullName }}</span>
              <div class="comment-time">
                <i class="bi bi-clock me-1"></i>
                {{ comment.creationDate | date:'medium' }}
              </div>
            </div>
          </div>
          <span class="badge comment-type-badge" 
               >
            {{ comment.type }}
          </span>
        </div>
        <div class="comment-content">
          {{ comment.content }}
        </div>
      </div>
    </div>
  </div>

  <!-- Message si aucun commentaire -->
  <ng-template #noComments>
    <div class="empty-comments text-center py-4">
      <i class="bi bi-chat-square-text fs-1 text-muted mb-2"></i>
      <p class="text-muted mb-0">Aucun commentaire pour le moment</p>
      <small class="text-muted">Soyez le premier à ajouter un commentaire</small>
    </div>
  </ng-template>

  <!-- Formulaire d'ajout de commentaire -->
  <div class="add-comment-form">
    <form (ngSubmit)="addComment()" #commentForm="ngForm">
      <div class="mb-3">
        <label for="commentContent" class="form-label fw-semibold">
          <i class="bi bi-plus-circle me-2"></i>Ajouter un commentaire
        </label>
        <div class="row g-2 mb-2">
          <div class="col-md-8">
            <textarea 
              id="commentContent"
              class="form-control" 
              [(ngModel)]="newComment.content" 
              name="commentContent"
              placeholder="Tapez votre commentaire ici..."
              rows="3"
              required
              #contentInput="ngModel">
            </textarea>
            <div class="invalid-feedback" *ngIf="contentInput.invalid && contentInput.touched">
              Le commentaire ne peut pas être vide
            </div>
          </div>
         
        </div>
      </div>
      
      <div class="d-flex justify-content-between align-items-center">
        <small class="text-muted">
          <i class="bi bi-info-circle me-1"></i>
          Les commentaires sont visibles par tous les participants
        </small>
        <div>
          <button 
            type="button" 
            class="btn btn-outline-secondary btn-sm me-2"
            (click)="resetCommentForm()">
            <i class="bi bi-arrow-clockwise me-1"></i>Réinitialiser
          </button>
          <button 
            type="submit" 
            class="btn btn-primary btn-sm"
            [disabled]="!newComment.content.trim() || isSubmittingComment"
            [class.disabled]="!newComment.content.trim() || isSubmittingComment">
            <span *ngIf="isSubmittingComment" class="spinner-border spinner-border-sm me-2" role="status"></span>
            <i class="bi bi-send me-1" *ngIf="!isSubmittingComment"></i>
            {{ isSubmittingComment ? 'Ajout...' : 'Ajouter' }}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

          </div>

          <!-- Footer -->
          <div class="modal-footer border-0 bg-light">
            <div class="d-flex justify-content-between w-100">
              <div class="text-muted small">
                <i class="bi bi-clock me-1"></i>
                Last viewed: {{ currentTime | date:'short' }}
              </div>
              <div>
               
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Backdrop -->
    <div class="modal-backdrop fade" 
         [class.show]="isVisible" 
         *ngIf="isVisible"
         (click)="closeDialog()">
    </div>